<?php

require '../includes/db.inc.php';

/*$mysql_server=mysql_server;
$mysql_user=mysql_user;
$mysql_password=mysql_password;
$db=db;*/

//Functions for user login	

	/*
     	 *	returns true if user and password is valids
		returns false otherwise
         */
	function verifyUserPassword($user,$password)	//input plain text username and password 
	{		
		global $mysql_server,$mysql_user,$mysql_password,$db;
		$connection = mysql_connect($mysql_server, $mysql_user, $mysql_password) or die(mysql_error());
		mysql_select_db($db, $connection) or die(mysql_error());
		
		$username=mysql_real_escape_string($user);
                $pswd=mysql_real_escape_string($password);
                
                $query="SELECT passwordHash,salt FROM Users WHERE userId='".$username."'";
		$result=mysql_query($query);
                if (!$result) {
                    die('Invalid query: ' . mysql_error());
                }
                
                $row= mysql_fetch_row($result);	
		mysql_close($connection);	
                if($row)	//if there is a record for the user
		{
			$password_hash=$row[0];
			$salt=$row[1];
			if(strcmp(hashPassword($password,$salt),$password_hash)==0)	//if passwords match
				return true;
			else
				return false;
		} 
		else	//if there is no record for the user
		{
			return false; 
		}		
	}

	function hashPassword($password,$salt)	
	{
		return md5($password.$salt);
	}

	function relogin()
	{
		header("Location: ../index.php");
	}

	/*function insertUsers()
	{
		global $mysql_server,$mysql_user,$mysql_password,$db;
		$connection = mysql_connect($mysql_server, $mysql_user, $mysql_password) or die(mysql_error());
		mysql_select_db($db, $connection) or die(mysql_error());

		$user='deep';
		$pswd='deep1';
		$salt= substr(md5(uniqid(rand(), true)),0,19);
		$pswd=hashPassword($pswd,$salt);
		$query="insert into Users values('".$user."','".$pswd."','".$salt."')";
		mysql_query($query) or die('Invalid query: ' . mysql_error().$query);
		$user='dev';
		$pswd='dev1';
		$salt= substr(md5(uniqid(rand(), true)),0,19);
		$pswd=hashPassword($pswd,$salt);
		$query="insert into Users values('".$user."','".$pswd."','".$salt."')";
		mysql_query($query) or die('Invalid query: ' . mysql_error());
		$user='wil';
		$pswd='abc';
		$salt= substr(md5(uniqid(rand(), true)),0,19);
		$pswd=hashPassword($pswd,$salt);
		$query="insert into Users values('".$user."','".$pswd."','".$salt."')";
		mysql_query($query) or die('Invalid query: ' . mysql_error());
	}*/

?>
